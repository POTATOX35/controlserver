<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Stream</title>
</head>
<body>
    <h1>Webcam Stream</h1>
    <img id="video-stream" src="" width="640" height="480" />

    <script>
        // WebSocket bağlantısı kur
        const socket = new WebSocket("wss://localhost:3001");

        socket.onopen = () => {
            console.log("WebSocket bağlantısı kuruldu.");
            // WebSocket üzerinden server'a webcam'i başlatma komutunu gönder
            socket.send(JSON.stringify({ command: "start_webcam" }));
        };

        socket.onerror = (error) => {
            console.error("WebSocket hatası:", error);
        };

        socket.onclose = () => {
            console.log("WebSocket bağlantısı kapatıldı.");
        };

        // Kamera verisini belirli aralıklarla al
        function fetchFrame() {
            fetch('https://localhost:3001/api/frame')  // Sunucudan kamera verisini al
                .then(response => response.json())
                .then(data => {
                    if (data.frame) {
                        const frameData = data.frame;
                        const byteCharacters = atob(frameData);
                        const byteArray = new Uint8Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteArray[i] = byteCharacters.charCodeAt(i);
                        }
                        const blob = new Blob([byteArray], { type: 'image/jpeg' });
                        const url = URL.createObjectURL(blob);
                        document.getElementById('video-stream').src = url;
                    }
                })
                .catch(error => console.error('Kamera verisi alınırken hata oluştu:', error));
        }

        // Kamera verisini her 100ms'de bir al
        setInterval(fetchFrame, 100);
    </script>
</body>
</html>
